name: Generate Mistica Tokens

on:
  workflow_dispatch:

jobs:
  record-screenshots:
    name: Record screenshots
    runs-on: self-hosted-novum-mac
    steps:
      - name: Checkout
        uses: actions/checkout@v3             

      - name: Enable screenshots recording
        run: |
          find Tests/MisticaCommonTests -name "*.swift" -exec sed -i '' 's/isRecording = false/isRecording = true/' {} +
          find Tests/MisticaSwiftUITests -name "*.swift" -exec sed -i '' 's/isRecording = false/isRecording = true/' {} +
          find Tests/MisticaTests -name "*.swift" -exec sed -i '' 's/isRecording = false/isRecording = true/' {} +
          
      - name: Launch tests and record screenshots
        run: make test
        continue-on-error: true
        
      - name: Disable screenshots recording
        run: |
          find Tests/MisticaCommonTests -name "*.swift" -exec sed -i '' 's/isRecording = true/isRecording = false/' {} +
          find Tests/MisticaSwiftUITests -name "*.swift" -exec sed -i '' 's/isRecording = true/isRecording = false/' {} +
          find Tests/MisticaTests -name "*.swift" -exec sed -i '' 's/isRecording = true/isRecording = false/' {} +

      - name: Commit Changes
        uses: stefanzweifel/git-auto-commit-action@v4
        with:
          file_pattern: '*.png'
          commit_message: Record screenshots automatically launched from GH action
        env:
          GITHUB_TOKEN: ${{ secrets.NOVUM_PRIVATE_REPOS }}


